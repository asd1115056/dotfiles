### Added by Zinit's installer
if [[ ! -f $HOME/.local/share/zinit/zinit.git/zinit.zsh ]]; then
    print -P "%F{33} %F{220}Installing %F{33}ZDHARMA-CONTINUUM%F{220} Initiative Plugin Manager (%F{33}zdharma-continuum/zinit%F{220})â€¦%f"
    command mkdir -p "$HOME/.local/share/zinit" && command chmod g-rwX "$HOME/.local/share/zinit"
    command git clone https://github.com/zdharma-continuum/zinit "$HOME/.local/share/zinit/zinit.git" && \
        print -P "%F{33} %F{34}Installation successful.%f%b" || \
        print -P "%F{160} The clone has failed.%f%b"
fi

source "$HOME/.local/share/zinit/zinit.git/zinit.zsh"
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
    zdharma-continuum/zinit-annex-as-monitor \
    zdharma-continuum/zinit-annex-bin-gem-node \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-rust

### End of Zinit's installer chunk

# Load starship theme
# line 1: `starship` binary as command, from github release
# line 2: starship setup at clone(create init.zsh, completion)
# line 3: pull behavior same as clone, source init.zsh
zinit ice as"command" from"gh-r" \
          atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
          atpull"%atclone" src"init.zsh"
zinit light starship/starship

#######################################################
# ZSH Basic Options
#######################################################

setopt autocd              # change directory just by typing its name
# setopt correct             # auto correct mistakes
setopt interactivecomments # allow comments in interactive mode
setopt magicequalsubst     # enable filename expansion for arguments of the form 'anything=expression'
setopt nonomatch           # hide error message if there is no match for the pattern
setopt notify              # report the status of background jobs immediately
setopt numericglobsort     # sort filenames numerically when it makes sense
setopt promptsubst         # enable command substitution in prompt

#######################################################
# History Configuration
#######################################################

HISTFILE=~/.zsh_history
HISTSIZE=50000
SAVEHIST=50000

setopt appendhistory         # append to history file
setopt sharehistory          # share history across terminals
setopt incappendhistory      # add commands immediately
setopt extended_history      # record timestamp and execution time
setopt hist_ignore_dups      # ignore duplicate commands
setopt hist_ignore_all_dups  # remove all duplicates from history
setopt hist_find_no_dups     # do not show duplicates when searching
setopt hist_ignore_space     # ignore commands starting with space
setopt hist_reduce_blanks    # remove unnecessary blanks
setopt hist_verify           # verify history expansion before running
setopt hist_expire_dups_first # expire duplicates first when max size is reached
setopt hist_no_store         # do not store history and fc commands
setopt hist_save_by_copy     # save history file by copy then rename for safety

#######################################################
# Plugin Configuration
#######################################################

#Plugin - zsh-autocomplete, autosuggestions, syntax-highlighting
zinit ice lucid atinit"ZINIT[COMPINIT_OPTS]=-C; zicompinit; zicdreplay"
zinit light marlonrichert/zsh-autocomplete

zinit lucid for \
  zsh-users/zsh-autosuggestions

#Plugin - reminds you to use existing aliases
zinit light MichaelAquilina/zsh-you-should-use

#Plugin - command-line fuzzy finder
zinit ice as"command" from"gh-r" \
    mv"fzf*/fzf -> fzf" \
    atclone"./fzf --zsh > init.zsh" \
    atpull"%atclone" src"init.zsh"
zinit light junegunn/fzf

#Plugin - modern replacement for ls with better colors and features
zinit ice as"command" from"gh-r" \
    mv"eza*/eza -> eza" \
    atload"alias ls='eza --icons=auto --group-directories-first'; \
           alias ll='eza -lh --icons=auto --group-directories-first'; \
           alias la='eza -lha --icons=auto --group-directories-first'; \
           alias lt='eza --tree --level=2 --icons=auto'; \
           alias lg='eza -lh --icons=auto --group-directories-first --git'"
zinit light eza-community/eza

#Plugin - cat clone with syntax highlighting and git integration
zinit ice as"command" from"gh-r" \
    mv"bat*/bat -> bat" \
    atload"alias cat='bat --paging=never --style=plain'; \
           alias batman='bat --paging=always --style=full'; \
           export MANPAGER='sh -c \"col -bx | bat -l man -p\"'"
zinit light sharkdp/bat

#Plugin - simplified and community-driven man pages
zinit ice as"command" from"gh-r" bpick"*linux*.tar.gz" \
    mv"tlrc*/tlrc -> tldr" \
    atload"alias help='tldr'"
zinit light tldr-pages/tlrc

#Plugin - smarter cd command (intelligent directory navigation)
# Note: using 'zz' for interactive mode to avoid conflict with zinit's 'zi' alias
zinit ice as"command" from"gh-r" \
    mv"zoxide*/zoxide -> zoxide" \
    atclone"./zoxide init zsh --cmd z > init.zsh" \
    atpull"%atclone" src"init.zsh" \
    atload"alias zz='__zoxide_zi'"
zinit light ajeetdsouza/zoxide

#Plugin - press ESC twice to add sudo to current command
zinit snippet OMZ::plugins/sudo/sudo.plugin.zsh

# Syntax highlighting must be loaded last
zinit ice lucid wait'0'
zinit light zdharma-continuum/fast-syntax-highlighting
